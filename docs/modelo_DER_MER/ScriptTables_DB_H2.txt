--Tabela MORADOR
CREATE TABLE MORADOR (
  ID_MORADOR INT PRIMARY KEY AUTO_INCREMENT,
  NOME VARCHAR(60) NOT NULL,
  SOBRENOME VARCHAR(60) NOT NULL,
  CPF VARCHAR(11) NOT NULL,
  RG VARCHAR(9) NOT NULL,
  NUMERO_APARTAMENTO VARCHAR(4),
  BLOCO VARCHAR(2),
  SENHA_ACESSO VARCHAR(120),
  DATA_INCERCAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  DATA_ALTERACAO TIMESTAMP
);

-- criando morador defafult (sindico)
INSERT INTO MORADOR (NOME, SOBRENOME, CPF, RG, NUMERO_APARTAMENTO, BLOCO, SENHA_ACESSO)
VALUES ('Admin', 'Padrão', '00011122233', '123456789', '001', 'A', 'p8gj1q8bswXwzUS1IqJbIYGiKQsLDMZinLEkhvP2wCfLxBHglsayz/5ak5QuxJ/E');

-- Índice único em CPF
CREATE UNIQUE INDEX CPF_UNIQUE ON MORADOR (CPF);

-- Tabela VISITANTE
CREATE TABLE VISITANTE (
  ID_VISITANTE INT PRIMARY KEY AUTO_INCREMENT,
  NOME VARCHAR(60) NOT NULL,
  SOBRENOME VARCHAR(60) NOT NULL,
  DOCUMENTO VARCHAR(15) NOT NULL,
  TELEFONE VARCHAR(11)
);

-- Tabela MORADOR_DEPENDENTE
CREATE TABLE MORADOR_DEPENDENTE (
  ID_MORADOR_DEPENDENTE INT PRIMARY KEY AUTO_INCREMENT,
  NOME VARCHAR(120) NOT NULL,
  DOCUMENTO VARCHAR(45),
  ID_MORADOR INT NOT NULL,
  FOREIGN KEY (ID_MORADOR) REFERENCES MORADOR (ID_MORADOR) ON DELETE NO ACTION ON UPDATE NO ACTION
);

-- Tabela AREA
CREATE TABLE AREA (
  ID_AREA INT PRIMARY KEY AUTO_INCREMENT,
  NOME VARCHAR(45) NOT NULL,
  LIMITE_PESSOAS INT NOT NULL
);

-- Tabela RESERVA_AREA
CREATE TABLE RESERVA_AREA (
  ID_RESERVA_AREA INT PRIMARY KEY AUTO_INCREMENT,
  DATA_RESERVA DATE NOT NULL,
  HORA_RESERVA DATE NOT NULL,
  ID_MORADOR INT NOT NULL,
  ID_AREA INT NOT NULL,
  FOREIGN KEY (ID_MORADOR) REFERENCES MORADOR (ID_MORADOR) ON DELETE NO ACTION ON UPDATE NO ACTION,
  FOREIGN KEY (ID_AREA) REFERENCES AREA (ID_AREA) ON DELETE NO ACTION ON UPDATE NO ACTION
);

-- Tabela REGISTRO_VISITANTE
CREATE TABLE REGISTRO_VISITANTE (
  ID_REGISTRO INT PRIMARY KEY AUTO_INCREMENT,
  ID_MORADOR INT NOT NULL,
  ID_VISITANTE INT NOT NULL,
  DATA_REGISTRO DATE NOT NULL,
  CHECK_IN CHAR(1),
  DATA_CHECK_IN DATE,
  FOREIGN KEY (ID_MORADOR) REFERENCES MORADOR (ID_MORADOR) ON DELETE NO ACTION ON UPDATE NO ACTION,
  FOREIGN KEY (ID_VISITANTE) REFERENCES VISITANTE (ID_VISITANTE) ON DELETE NO ACTION ON UPDATE NO ACTION
);


-- Tabela REGISTRO_OCORRENCIA
CREATE TABLE REGISTRO_OCORRENCIA (
ID_OCORRENCIA INT NOT NULL AUTO_INCREMENT,
TITULO VARCHAR(20) NOT NULL,
OCORRENCIA VARCHAR(250) NOT NULL,
DATA_OCORRENCIA DATE NOT NULL,
DATA_REGISTRO_OCORRENCIA DATE NOT NULL,
ID_MORADOR INT NOT NULL,
PRIMARY KEY (ID_OCORRENCIA, ID_MORADOR),
FOREIGN KEY (ID_MORADOR) REFERENCES MORADOR (ID_MORADOR) ON DELETE NO ACTION ON UPDATE NO ACTION
);

-- Tabela CONVIDADO_RESERVA
CREATE TABLE CONVIDADO_RESERVA (
  ID_CONVIDADO INT PRIMARY KEY  AUTO_INCREMENT,
  NOME VARCHAR(60) NOT NULL,
  DOCUMENTO VARCHAR(15) NOT NULL,
  ID_RESERVA_AREA INT NOT NULL,
  ID_MORADOR INT NOT NULL,
  FOREIGN KEY (ID_RESERVA_AREA) REFERENCES RESERVA_AREA (ID_RESERVA_AREA) ON DELETE NO ACTION ON UPDATE NO ACTION,
  FOREIGN KEY (ID_MORADOR) REFERENCES MORADOR (ID_MORADOR) ON DELETE NO ACTION ON UPDATE NO ACTION
);
